import{r as c,u as g,j as n,m as D,S as j,a as t,I as Ae,L as a,F as V,C as U,b as oe,P as k,g as J,c as ie,d as K,e as X,f as B,A as Q,h as he,i as q,k as de,l as pe,n as Se,o as re,p as I,q as b,s as M,t as ce,v as ve,w as Te,x as ge,y as be,z as Ce,B as Le,D as le,E as fe,G as ye,H as me,M as ue,J as Ie,K as Ee,N as ke,O as He,Q as _e,R as we,T as Re,U as Ue,V as Me,W as Ve,X as De}from"./index-9981ad0a.js";function Fe(){const{View:o,Contact:C}=c.useContext(z),l=g(k.Settings),O=g(k.PhoneNumber),[r,E]=c.useState(null),[p,S]=o,[e,s]=C,u=g(M.APPS.PHONE.contacts),[f,i]=c.useState(!1),[m,T]=c.useState(!1);c.useEffect(()=>E(e.number),[]);const N=()=>{I("Phone",{action:"removeContact",number:e.number},!0).then(h=>{if(!h)return b("warning","Failed to remove contact");M.APPS.PHONE.contacts.set(u.filter(v=>v.number!==e.number)),s(null),S("Contacts")})},A=()=>{I("Phone",{action:"toggleBlock",number:e.number,blocked:!e.blocked},!0).then(h=>{if(h===void 0)return b("warning","Failed to toggle block");s({...e,blocked:!e.blocked}),M.APPS.PHONE.contacts.set(u.map(v=>v.number===e.number?{...v,blocked:!v.blocked}:v))})},H=()=>{I("Phone",{action:"toggleFavourite",number:e.number,favourite:!e.favourite},!0).then(h=>{if(!h)return b("warning","Failed to toggle favourite");s({...e,favourite:!e.favourite}),M.APPS.PHONE.contacts.set(u.map(v=>v.number===e.number?{...v,favourite:!v.favourite}:v))})},_=()=>{if(!e.number||e.number.length===0)return S("Contacts");e.number===O?(k.Settings.patch({name:e.firstname,avatar:e.avatar??l.avatar}),I("setPhoneName",e.firstname),I("setSettings",k.Settings.value),i(h=>!h),M.APPS.PHONE.contacts.set(u.map(h=>h.number===e.number?{...h,...e}:h))):(e.lastname=e.lastname??"",I("Phone",{action:"updateContact",data:{...e,oldNumber:r}},!0).then(h=>{if(!h)return b("warning","Failed to update contact");i(v=>!v),M.APPS.PHONE.contacts.set(u.map(v=>v.number===e.number?{...v,...e}:v)),E(e.number)}))},w=()=>{e&&U.PopUp.set({title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:a("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{I("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(h=>{h&&I("Messages",{action:"sendMessage",number:e.number,content:`<!SENT-LOCATION-X=${ce(h.x,2)}Y=${ce(h.y,2)}!>`,attachments:[]}).then(v=>{if(!v)return b("warning","something went wrong while sending location");Q.patch({active:{name:"Messages",data:{number:e.number,name:e.firstname&&X(e.firstname,e.lastname),avatar:e.avatar},view:"messages"}})})})}}]})},$=c.useRef(!0);return c.useEffect(()=>{$.current&&$.current&&(E(e.number),$.current=!1,T(e.number===O))},[e]),n(D.div,{...j("right","contact",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:n("div",{className:"items",children:[f?t("span",{}):n("div",{className:"back",onClick:()=>{S(e.from),s(null)},children:[t(Ae,{}),a(`APPS.PHONE.${e.from.toUpperCase()}.TITLE`)]}),e.firstname&&!e.company&&t("span",{onClick:()=>{f?_():i(h=>!h)},children:f?a("APPS.PHONE.DONE"):a("APPS.PHONE.EDIT")})]})}),t("div",{className:"content",children:f?t(V,{children:n("div",{className:"contact nohover",children:[n("div",{className:"user",onClick:()=>{U.ContextMenu.set({buttons:[{title:a("APPS.PHONE.CONTACTS.CHANGE_AVATAR"),cb:()=>{var h,v,P;U.Gallery.set({allowExternal:(P=(v=(h=oe)==null?void 0:h.value)==null?void 0:v.AllowExternal)==null?void 0:P.Other,onSelect:R=>s({...e,avatar:R.src})})}},{title:a("APPS.PHONE.CONTACTS.REMOVE_AVATAR"),color:"red",cb:()=>{s({...e,avatar:null}),m&&k.Settings.set({...k.Settings.value,avatar:null})}}]})},children:[e.avatar||m&&l.avatar?t("div",{className:"avatar bigger",style:{backgroundImage:`url(${e.avatar??l.avatar})`}}):e.firstname?t("div",{className:"avatar bigger",children:J(e.firstname,e.lastname)}):t(ie,{}),t("span",{children:a("APPS.PHONE.EDIT")})]}),n("div",{className:"contact-info",children:[t("div",{className:"item input",children:t(K,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.FIRST_NAME"),value:e.firstname,onChange:h=>s({...e,firstname:h.target.value}),maxLength:20})}),!m&&t("div",{className:"item input",children:t(K,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.LAST_NAME"),value:e.lastname??"",onChange:h=>s({...e,lastname:h.target.value}),maxLength:20})})]}),t("div",{className:"contact-info",children:t("div",{className:"item input",children:t(K,{className:"phone_number",type:"number",placeholder:a("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:e==null?void 0:e.number,maxLength:20,disabled:m,onChange:h=>{if(m)return;let v=h.target.value.slice(-1).charCodeAt(0);v>=48&&v<=57&&h.target.value.length<=10&&s({...e,number:h.target.value})}})})}),n("div",{className:"contact-info",children:[t("div",{className:"item input",children:t(K,{className:"phone_number",type:"email",placeholder:a("APPS.PHONE.CONTACTS.EMAIL"),defaultValue:e==null?void 0:e.email,maxLength:20,onChange:h=>{m||h.target.value.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i)&&s({...e,email:h.target.value})}})}),t("div",{className:"item input",children:t(K,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.ADDRESS"),defaultValue:e==null?void 0:e.address,maxLength:20,onChange:h=>{m||s({...e,address:h.target.value})}})})]}),!m&&t("div",{className:"contact-info",children:t("div",{className:"item red",onClick:()=>{U.PopUp.set({title:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TITLE"),description:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TEXT"),buttons:[{title:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_CANCEL")},{title:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_DELETE"),color:"red",cb:N}]})},children:a("APPS.PHONE.CONTACTS.DELETE_CONTACT")})})]})}):t(V,{children:n("div",{className:"contact nohover details",children:[n("div",{className:"user",children:[e.avatar||m&&l.avatar?t("div",{className:"avatar bigger",style:{backgroundImage:`url(${m?l.avatar:e.avatar})`}}):e.firstname?t("div",{className:"avatar bigger",children:J(e.firstname,e.lastname)}):t(ie,{}),t("div",{className:"name",children:e.firstname?X(e.firstname,e.lastname):B(e.number)})]}),n("div",{className:"actions",children:[n("div",{className:"item","data-disabled":!!(m||e.company),onClick:()=>{Q.patch({active:{name:"Messages",data:{number:e.number,name:e.firstname&&X(e.firstname,e.lastname),avatar:e.avatar,view:"messages"}}})},children:[t(he,{}),a("APPS.PHONE.CONTACTS.MESSAGE")]}),n("div",{className:"item call","data-disabled":m,onClick:()=>{q({number:e.number,company:e.company,companylabel:e.company&&e.firstname})},children:[t(de,{}),a("APPS.PHONE.CONTACTS.CALL")]}),n("div",{className:"item","data-disabled":!!(m||e.company),onClick:()=>{q({number:e.number,company:e.company,companylabel:e.company&&e.firstname,videoCall:!0})},children:[t(pe,{}),a("APPS.PHONE.CONTACTS.VIDEO")]}),n("div",{className:"item","data-disabled":!!e.company,onClick:()=>{e.company||U.Share.set({type:"contact",data:{number:e.number,firstname:e.firstname,lastname:e.lastname,avatar:e.avatar||m&&l.avatar,email:e.email,address:e.address}})},children:[t(Se,{}),a("APPS.PHONE.CONTACTS.SHARE")]})]}),!e.company&&n(V,{children:[t("div",{className:"contact-info",children:t("div",{className:"item",onClick:()=>{re(e.number),U.PopUp.set({title:a("COMPONENTS.SHARE.COPY_POPUP.TITLE"),description:a("COMPONENTS.SHARE.COPY_POPUP.DESCRIPTION"),buttons:[{title:a("COMPONENTS.SHARE.COPY_POPUP.OK")}]})},children:t("div",{className:"value",children:B(e.number)})})}),(e.email||e.address)&&n("div",{className:"contact-info",children:[e.email&&n("div",{className:"item",onClick:()=>re(e.email),children:[t("div",{className:"title",children:a("APPS.PHONE.CONTACTS.EMAIL").toLowerCase()}),t("div",{className:"value",children:e.email})]}),e.address&&n("div",{className:"item",onClick:()=>re(e.address),children:[t("div",{className:"title",children:a("APPS.PHONE.CONTACTS.ADDRESS").toLowerCase()}),t("div",{className:"value",children:e.address})]})]}),t("div",{className:"contact-info",children:e.firstname?t(V,{children:!m&&n(V,{children:[t("div",{className:"item",onClick:()=>w(),children:a("APPS.PHONE.CONTACTS.SHARE_LOCATION")}),e.favourite?t("div",{className:"item red",onClick:()=>H(),children:a("APPS.PHONE.CONTACTS.REMOVE_FAVORITE")}):t("div",{className:"item",onClick:()=>H(),children:a("APPS.PHONE.CONTACTS.ADD_FAVORITE")}),e.blocked?t("div",{className:"item red",onClick:()=>{U.PopUp.set({title:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TITLE"),description:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TEXT").format({number:B(e.number)}),buttons:[{title:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_CANCEL")},{title:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_UNBLOCK"),cb:()=>A()}]})},children:a("APPS.PHONE.CONTACTS.UNBLOCK_CALLER")}):t("div",{className:"item red",onClick:()=>{U.PopUp.set({title:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TITLE"),description:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TEXT").format({number:B(e.number)}),buttons:[{title:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_CANCEL")},{title:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_BLOCK"),color:"red",cb:()=>{A()}}]})},children:a("APPS.PHONE.CONTACTS.BLOCK_CALLER")})]})}):t("div",{className:"item",onClick:()=>S("NewContact"),children:a("APPS.PHONE.CONTACTS.ADD_CONTACT")})})]})]})})})]})}function xe(){const{View:o,viewContact:C}=c.useContext(z),l=g(k.Settings),[O,r]=o,E=g(k.PhoneNumber),p=g(M.APPS.PHONE.contacts),[S,e]=c.useState("");return n(D.div,{...j("left","contacts",.2),className:"animation-container",children:[n("div",{className:"contacts-header",children:[n("div",{className:"items",children:[t("div",{className:"title",children:a("APPS.PHONE.CONTACTS.TITLE")}),t(ve,{onClick:()=>r("NewContact")})]}),t(Te,{placeholder:a("SEARCH"),onChange:s=>e(s.target.value)})]}),t("div",{className:"content",children:n("div",{className:"contact-list",children:[t("div",{className:"letters",children:[...Array(26)].map((s,u)=>{let f=String.fromCharCode(u+65);return t("a",{children:f},u)})}),t("div",{className:"contact card",onClick:()=>C({firstname:l==null?void 0:l.name,number:E},"Contacts"),children:n("div",{className:"profile",children:[l.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${l.avatar})`}}):t("div",{className:"avatar",children:J(l==null?void 0:l.name)}),n("div",{className:"profile-info",children:[t("div",{className:"name",children:l==null?void 0:l.name}),t("div",{className:"info",children:a("APPS.PHONE.CONTACTS.MY_CARD")})]}),t(ge,{})]})}),p&&n(V,{children:[Object.entries(p.filter(s=>X(s.firstname,s.lastname).toLowerCase().includes(S.toLowerCase())).sort((s,u)=>s.firstname.localeCompare(u.firstname)).reduce((s,u)=>{let f=u.firstname.charAt(0).toUpperCase();return s[f]||(s[f]=[]),s[f].push(u),s},{})).map(([s,u],f)=>n("div",{children:[t("div",{id:s,className:`divider ${f===0?"no-border":""}`,children:s}),t(D.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"contacts",children:u.map((i,m)=>n("div",{className:"contact item border",onClick:()=>C(i,"Contacts"),children:[i.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${i.avatar})`}}):t("div",{className:"avatar",children:J(i.firstname,i.lastname)}),n("div",{className:"details",children:[t("div",{className:"name",children:X(i.firstname,i.lastname)}),t("div",{className:"phone-number",children:B(i.number)})]})]},m))})]},f)),n("div",{className:"total-contacts",children:[p.length," ",a("APPS.PHONE.CONTACTS.TITLE")]})]})]})})]})}function Be(){const{viewContact:o}=c.useContext(z),C=g(M.APPS.PHONE.contacts),[l,O]=c.useState(!1);return n(D.div,{...j("left","favourites",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:n("div",{className:"items",children:[t("div",{className:"title",children:a("APPS.PHONE.FAVOURITES.TITLE")}),t("span",{onClick:()=>O(!l),children:l?a("APPS.PHONE.DONE"):a("APPS.PHONE.EDIT")})]})}),t("div",{className:"content",children:t("div",{className:"favourite",children:C.filter(r=>r.favourite||r.company).sort((r,E)=>r.company?-1:1).map((r,E)=>{let p=X(r.firstname,r.lastname);return n(D.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"item",onClick:()=>{U.PopUp.set({title:a("APPS.PHONE.CALL.CALL_TITLE").format({name:p}),description:a("APPS.PHONE.CALL.CALL_TEXT").format({name:p}),buttons:[{title:a("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:a("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{q({number:r.number,company:r.company,companylabel:r.firstname})}}]})},children:[n("div",{className:"user",children:[l&&!r.company&&t(be,{onClick:S=>{S.stopPropagation(),U.PopUp.set({title:a("APPS.PHONE.FAVOURITES.REMOVE_TITLE"),description:a("APPS.PHONE.FAVOURITES.REMOVE_TEXT"),buttons:[{title:a("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_CANCEL")},{title:a("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_REMOVE"),color:"red",cb:()=>{I("Phone",{action:"toggleFavourite",number:r.number,favourite:!1},!0).then(e=>{if(!e)return b("warning","Failed to remove favourite");M.APPS.PHONE.contacts.set(C.map(s=>s.number===r.number?{...s,favourite:!s.favourite}:s))})}}]})}}),r.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${r.avatar})`}}):t("div",{className:"avatar",children:J(r.firstname,r.lastname)}),n("div",{className:"info",children:[p,t("span",{children:B(r.number)})]})]}),t(Ce,{onClick:S=>{S.stopPropagation(),o(r,"Favourites")}})]},E)})})})]})}const F=[697,770,852,941],x=[1209,1336,1477,1633],Pe={1:[F[0],x[0]],2:[F[0],x[1]],3:[F[0],x[2]],4:[F[1],x[0]],5:[F[1],x[1]],6:[F[1],x[2]],7:[F[2],x[0]],8:[F[2],x[1]],9:[F[2],x[2]],"*":[F[3],x[0]],0:[F[3],x[1]],"#":[F[3],x[2]]},$e=[{key:"1",letters:""},{key:"2",letters:"ABC"},{key:"3",letters:"DEF"},{key:"4",letters:"GHI"},{key:"5",letters:"JKL"},{key:"6",letters:"MNO"},{key:"7",letters:"PQRS"},{key:"8",letters:"TUV"},{key:"9",letters:"WXYZ"},{key:"*",letters:""},{key:"0",letters:"+"},{key:"#",letters:""}],ne={0:2.5,12:2,17:1.75};function Ke(){const o=g(k.Settings),C=g(k.CallData),l=g(Q),{View:O,Contact:r,viewContact:E}=c.useContext(z),[p,S]=O,[e,s]=r,[u,f]=c.useState(null),[i,m]=c.useState(""),T=c.useRef(null),N=c.useRef([]),A=c.useRef(null),H=c.useRef(null),_=c.useRef(!0),[w,$]=c.useState(2.5);c.useEffect(()=>{var d;if(!T.current&&((d=l==null?void 0:l.active)==null?void 0:d.name)==="Phone")return T.current=new AudioContext,()=>{T.current&&(v(),T.current.close(),T.current=null)}},[l==null?void 0:l.active]),c.useEffect(()=>{var d;_.current=!!(((d=l==null?void 0:l.active)==null?void 0:d.name)==="Phone"&&(!C||C!=null&&C.banner))},[l==null?void 0:l.active,C]),c.useEffect(()=>{document.addEventListener("keydown",R),document.addEventListener("keyup",L),i==="0"&&$(2.5);let d=0;for(let y=0;y<Object.keys(ne).length;y++)i.length>=parseInt(Object.keys(ne)[y])&&(d=ne[Object.keys(ne)[y]]);return $(d),()=>{document.removeEventListener("keydown",R),document.removeEventListener("keyup",L)}},[i]);const h=d=>{if(!T.current)return;const y=T.current,[G,Z]=Pe[d],Y="sine",ee=y.createOscillator();ee.frequency.value=G,ee.type=Y;const te=y.createOscillator();te.frequency.value=Z,te.type=Y;const ae=y.createGain();ae.gain.value=.2*(o.sound.volume??.5),ee.connect(ae),te.connect(ae),ae.connect(y.destination),ee.start(),te.start();const Oe=setTimeout(()=>{v()},1500);N.current.push([ee,te,ae,Oe])},v=()=>{N.current.forEach(([d,y,G,Z])=>{clearTimeout(Z),T.current&&(d.stop(),y.stop(),d.disconnect(),y.disconnect(),G.disconnect())}),A.current=null,N.current=[]},P=d=>{_.current&&(d=="delete"?m(y=>y.slice(0,-1)):d.match(/^[0-9]+$/)&&m(y=>y+d),Pe[d]&&(A.current&&v(),A.current=d,h(d)))},R=d=>{A.current||d.repeat||(d.key.match(/^[0-9]+$/)?(A.current=d.key,P(d.key)):d.key==="Backspace"?P("delete"):d.key==="Enter"&&i.length>=3&&q({number:i}))},L=d=>{d.key===A.current&&v()};return c.useEffect(()=>{if(i.length!==Le())return f(null);f(le(i))},[i]),n(D.div,{...j("left","keypad",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:n("div",{className:"items",children:[t("div",{className:"title",children:a("APPS.PHONE.KEYPAD.TITLE")}),t(ve,{onClick:()=>{if(m(""),u)E(u,"Keypad");else{let d=le(i);d?(s({...d,number:i}),S("NewContact")):(s({number:i}),S("NewContact"))}}})]})}),t("div",{className:"content noscroll",children:n("div",{className:"keypad-container",children:[t("div",{className:"inputbox",children:t("div",{className:"input",style:{fontSize:`${w}rem`},children:B(i)})}),t("div",{className:"keypad-wrapper",children:n("div",{className:"keypad",children:[$e.map(d=>n("div",{onMouseDown:()=>P(d.key),onMouseUp:()=>v(),children:[d.key,d.letters&&t("span",{children:d.letters})]},d.key)),t("span",{}),t("div",{className:"call",onClick:()=>{i.length>=3&&q({number:i})},children:t(de,{})}),t("div",{className:"delete",onMouseDown:()=>{if(!fe("Phone"))return;P("delete"),H.current&&clearInterval(H.current);const d=setInterval(()=>{P("delete")},100);H.current=d},onMouseUp:()=>{H.current&&(clearInterval(H.current),H.current=null)},children:t(ye,{})})]})})]})})]})}function Ge(){const{View:o,Contact:C}=c.useContext(z),l=g(k.PhoneNumber),[O]=C,[r,E]=o,p=g(M.APPS.PHONE.contacts),S=g(k.Settings),[e,s]=c.useState(null),[u,f]=c.useState(!1);c.useEffect(()=>{k.Styles.TextColor.set(S.display.theme=="dark"?"#ffffff":"#000000")},[]),c.useEffect(()=>{O&&O.number&&s({...e,number:O.number})},[O]),c.useEffect(()=>{e&&f(e.firstname&&e.number!==void 0)},[e]);const i=()=>{if(e){if(!e.number||(e==null?void 0:e.number)===l)return E("Contacts");e.lastname=(e==null?void 0:e.lastname)??"",I("Phone",{action:"saveContact",data:e},!0).then(m=>{if(!m)return b("warning","Failed to save contact");M.APPS.PHONE.contacts.set([...p,e]),E("Contacts")})}};return n(D.div,{...j("up","newcontact",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:n("div",{className:"items",children:[t("div",{className:"back",onClick:()=>E("Contacts"),children:a("APPS.PHONE.CANCEL")}),t("span",{className:u?"":"disabled",onClick:()=>{u&&i()},children:a("APPS.PHONE.DONE")})]})}),t("div",{className:"content",children:t(V,{children:n("div",{className:"contact nohover",children:[t("div",{className:"user",onClick:()=>{var m,T,N;U.Gallery.set({allowExternal:(N=(T=(m=oe)==null?void 0:m.value)==null?void 0:T.AllowExternal)==null?void 0:N.Other,onSelect:A=>s({...e,avatar:A.src})})},children:e!=null&&e.avatar?n(V,{children:[t("div",{className:"profile-image bigger transparent",style:{backgroundImage:`url(${e.avatar})`}}),t("span",{children:a("APPS.PHONE.EDIT")})]}):n(V,{children:[t(ie,{className:"big"}),t("span",{className:"add",children:a("APPS.PHONE.CONTACTS.ADD_PHOTO")})]})}),n("div",{className:"contact-info",children:[t("div",{className:"item input",children:t(K,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.FIRST_NAME"),onChange:m=>s({...e,firstname:m.target.value}),maxLength:20})}),t("div",{className:"item input",children:t(K,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.LAST_NAME"),onChange:m=>s({...e,lastname:m.target.value}),maxLength:20})})]}),t("div",{className:"contact-info",children:t("div",{className:"item input",children:t(K,{className:"phone_number",type:"number",placeholder:a("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:O==null?void 0:O.number,maxLength:15,onChange:m=>{let T=m.target.value.slice(-1).charCodeAt(0);T>=48&&T<=57&&s({...e,number:m.target.value})}})})})]})})})]})}const se=me([]).mock(ue.RecentCalls);function Xe(){const{viewContact:o}=c.useContext(z),[C,l]=c.useState("all"),O=g(se),r=["all","missed"],[E,p]=c.useState(0),[S,e]=c.useState(!1),[s,u]=c.useState(!1);c.useEffect(()=>{p(0),e(!1),I("Phone",{action:"getRecent",page:0,missed:C==="missed"},ue.RecentCalls.filter(i=>C==="missed"?!i.answered:!0)).then(i=>{if(!i)return b("error","Failed to get recent calls");se.set(i)})},[C]);const f=i=>{if(S||s)return;let m=document.querySelector("#last");if(!m)return;!Ee(m)&&(u(!0),b("info","Fetching more recent calls, page: ",E+1),I("Phone",{action:"getRecent",page:E+1,missed:C==="missed"},null).then(N=>{N&&N.length>0?(se.set([...se.value,...N]),u(!1),b("info","Received more recent calls, page: ",E+1),N.length<25&&e(!0)):(b("info","Received all recent calls, nothing more to fetch. Page: ",E+1),e(!0))}),p(N=>N+1))};return n(D.div,{...j("left","recent",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:n("div",{className:"items col",children:[t("div",{className:"selector-container",children:t("div",{className:"selector",children:r.map((i,m)=>t("div",{className:"option","data-active":C===i,onClick:()=>l(i),children:a(`APPS.PHONE.RECENTS.${i.toUpperCase()}`)},m))})}),t("div",{className:"title",children:a("APPS.PHONE.RECENTS.TITLE")})]})}),t("div",{className:"content",onScroll:f,children:t(D.div,{...j(C==="all"?"left":"right",C,.2),className:"recent-calls",children:O.map((i,m)=>{var A,H,_;let T=O.length-1===m?"last":"",N=le(i.number);return n(D.div,{id:T,initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"item","data-missed":!i.called&&!i.answered?"true":"false",onClick:()=>{if(i.hideCallerId)return;let w;N!=null&&N.name?w=N.name:w=B(i.number),U.PopUp.set({title:a("APPS.PHONE.CALL.CALL_TITLE").format({name:w}),description:a("APPS.PHONE.CALL.CALL_TEXT").format({name:w}),buttons:[{title:a("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:a("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{q({number:i.number})}}]})},children:[n("div",{className:"user",children:[i.hideCallerId?t("div",{className:"avatar",style:{backgroundImage:`url(./assets/img/avatar-placeholder-${(_=(H=(A=k)==null?void 0:A.Settings)==null?void 0:H.value)==null?void 0:_.display.theme}.svg)`}}):N!=null&&N.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${N==null?void 0:N.avatar})`}}):t("div",{className:"avatar",children:J(N==null?void 0:N.name)}),t("div",{className:"info",children:i.hideCallerId?n(V,{children:[a("APPS.PHONE.CALL.NO_CALLER_ID"),t("span",{children:a("APPS.PHONE.CALL.UNKNOWN")})]}):N!=null&&N.name?n(V,{children:[N.name,t("span",{children:B(i.number)})]}):n(V,{children:[B(i.number),t("span",{children:a("APPS.PHONE.CALL.UNKNOWN")})]})})]}),n("div",{className:"info",children:[t("div",{className:"date",children:Ie(i.timestamp)}),t(Ce,{onClick:w=>{if(w.stopPropagation(),i.hideCallerId)return b("info","Call info couldn't be loaded since user called with 'No Caller ID'");N!=null&&N.name?o({...N,number:i.number},"Recents"):o({...i},"Recents")}})]})]},m)})})})]})}const Ne=me(null),W=me([]);function je(){const o=g(W),[C,l]=c.useState(0),[O,r]=c.useState(!1),[E,p]=c.useState(!1);c.useEffect(()=>{l(0),r(!1),I("Phone",{action:"getVoiceMails",page:0},ue.VoiceMails).then(e=>{if(!e)return b("error","Failed to get voicemails");b("info","Received voicemails",e),W.set(e)})},[]);const S=()=>{if(O||E)return;let e=document.querySelector("#last");if(!e)return;!Ee(e)&&(p(!0),b("info","Fetching more voicemails, page: ",C+1),I("Phone",{action:"getVoiceMails",page:C+1}).then(u=>{u&&u.length>0?(W.set([...W.value,...u]),p(!1),b("info","Received more voicemails, page: ",C+1),u.length<25&&r(!0)):(b("info","Received all voicemails, nothing more to fetch. Page: ",C+1),r(!0))}),l(u=>u+1))};return n(D.div,{...j("left","voicemail",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:t("div",{className:"items",children:t("div",{className:"title",children:a("APPS.PHONE.VOICEMAIL.TITLE")})})}),t("div",{className:"content",onScroll:S,children:t("div",{className:"voicemails",children:o.map(e=>{let s=o[o.length-1]?"last":"";return t(Ye,{data:e,last:s},e.id)})})})]})}const Ye=({data:o,last:C})=>{const l=g(oe),O=g(k.Settings),r=c.useRef(null),[E,p]=c.useState(!1),[S,e]=c.useState(!1),[s,u]=c.useState(!1),[f,i]=c.useState(null),[m,T]=c.useState(0),N=g(Ne),[A,H]=c.useState(null),_=g(Re),w=g(Q);c.useEffect(()=>{var P;_!=null&&_.visible&&((P=r.current)==null||P.pause(),u(!1))},[_==null?void 0:_.visible,w==null?void 0:w.active]),c.useEffect(()=>{var R;r.current=new Audio(o.url),r.current.src=o.url,r.current.volume=O.sound.volume??.5,r.current.addEventListener("ended",()=>{u(!1)}),r.current.addEventListener("timeupdate",()=>{T(r.current.currentTime)});let P=(R=M.APPS.PHONE.contacts)==null?void 0:R.value;if(P&&o.number){let L=P.find(d=>d.number==o.number);L&&H(L)}return()=>{var L,d;(L=r.current)==null||L.pause(),(d=r.current)==null||d.remove(),r.current=null}},[]),c.useEffect(()=>{var P;N&&N!==o.id&&((P=r.current)==null||P.pause(),u(!1),p(!1))},[N]),c.useEffect(()=>{O.sound.volume&&(r.current.volume=O.sound.volume)},[O.sound.volume]),c.useEffect(()=>{var P;u(!1),T(0),(P=r.current)==null||P.pause(),r.current.currentTime=0,E&&Ne.set(o.id)},[E]);const $=P=>{P=P/1e3;const R=Math.floor(P/60),L=ce(P-R*60,0);return`${R}:${L<10?"0"+L:L}`},h=(P,R)=>{const L=new Date(P),d=L.getFullYear(),y=L.getMonth()+1,G=L.getDate(),Z=L.getHours(),Y=L.getMinutes();return R?`${G} ${L.toLocaleDateString(l.DateLocale,{month:"long"})} ${d} ${a("APPS.PHONE.VOICEMAIL.AT")} ${Z}:${Y<10?"0"+Y:Y}`:`${d}-${y<10?"0"+y:y}-${G<10?"0"+G:G}`},v={light:{active:"#333333",track:"#cccccc"},dark:{active:"#FFFFFF",track:"#999999"}};return t(D.div,{className:"voicemail-item",id:C,initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},onClick:()=>p(!E),"data-expanded":E,children:n("div",{className:"voicemail-info",children:[n("div",{className:"voicemail-row",children:[n("div",{className:"details",children:[t("div",{className:"voicemail-title",children:o.hideCallerId?a("APPS.PHONE.CALL.NO_CALLER_ID"):A?X(A==null?void 0:A.firstname,A==null?void 0:A.lastname):B(o.number)}),t("div",{className:"subtitle",children:h(o.timestamp,!0)})]}),!E&&t("div",{className:"info",children:t("div",{className:"duration",children:$(o.duration)})})]}),t(ke,{children:E&&n(D.div,{className:"voicemail-actions",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:[n("div",{className:"voicemail-duration-slider",onClick:P=>P.stopPropagation(),children:[t(K,{type:"range",min:0,max:100,value:f||m/o.duration*100,style:{background:`linear-gradient(to right, ${v[O.display.theme].active} 0%, ${v[O.display.theme].active} ${f||m/(o.duration/1e3)*100}%, ${v[O.display.theme].track} ${f||m/(o.duration/1e3)*100}%, ${v[O.display.theme].track} 100%)`},onMouseDown:P=>{fe("Phone")&&(P.stopPropagation(),e(!0))},onMouseUp:P=>{if(P.stopPropagation(),e(!1),f){if(!r.current)return b("warning","Audio ref is null");r.current.currentTime=o.duration/1e3/100*f,i(null)}},onChange:P=>{P.stopPropagation(),i(P.target.value)}}),n("div",{className:"duration",children:[t("div",{children:$(m)??"0:00"}),t("div",{children:$(o.duration)})]})]}),n("div",{className:"voicemail-item-footer",children:[t("div",{className:"play",onClick:P=>{if(P.stopPropagation(),!r.current)return b("warning","Audio ref is null");s?r.current.pause():r.current.play().catch(()=>b("error","Failed to play voicemail",o.id)),u(!s)},children:s?t(He,{}):t(_e,{})}),n("div",{className:"buttons",children:[o.number&&n(V,{children:[t(de,{className:"green",onClick:P=>{P.stopPropagation(),U.PopUp.set({title:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.TITLE"),description:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.DESCRIPTION").format({number:B(o.number)}),buttons:[{title:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.CANCEL")},{title:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.PROCEED"),cb:()=>{q({number:o.number})}}]})}}),t(he,{className:"blue",onClick:P=>{P.stopPropagation(),Q.patch({active:{name:"Messages",data:{number:o.number,name:(A==null?void 0:A.firstname)&&X(A.firstname,A.lastname),avatar:A==null?void 0:A.avatar},view:"messages"}})}})]}),t(we,{className:"red",onClick:P=>{P.stopPropagation(),U.PopUp.set({title:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.TITLE"),description:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.DESCRIPTION"),buttons:[{title:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.CANCEL")},{title:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.PROCEED"),cb:()=>{I("Phone",{action:"deleteVoiceMail",id:o.id},!0).then(R=>{if(!R)return b("error","Failed to delete voicemail");b("info","Deleted voicemail",o.id),W.set(W.value.filter(L=>L.id!==o.id))})}}]})}})]})]})]})})]})})};const z=c.createContext(null);function ze(){const o=g(Q).active,[C,l]=c.useState("Contacts"),[O,r]=c.useState(null),E=g(M.APPS.PHONE.contacts),p=(s,u)=>{r({...s,from:u}),l("Contact")};c.useEffect(()=>{var s,u;if(E&&o!=null&&o.data)if(((s=o.data)==null?void 0:s.view)==="contact"){let f=E==null?void 0:E.find(i=>i.number==o.data.number);if(!f)return;r({...f||{number:o.data.number},from:"Contacts"}),l("Contact")}else((u=o.data)==null?void 0:u.view)==="newContact"&&(r({number:o.data.number,from:"Contacts"}),l("NewContact"))},[]);const S={Favourites:t(Be,{}),Contacts:t(xe,{}),Recents:t(Xe,{}),Keypad:t(Ke,{}),NewContact:t(Ge,{}),Contact:t(Fe,{}),Voicemail:t(je,{})},e={Favourites:t(Ue,{}),Recents:t(Me,{}),Contacts:t(ie,{}),Keypad:t(Ve,{}),Voicemail:t(De,{})};return n("div",{className:"phone-app-container",children:[t(z.Provider,{value:{Contact:[O,r],View:[C,l],viewContact:p},children:t("div",{className:"wrapper",children:S[C]})}),t("div",{className:"footer",children:Object.keys(e).map((s,u)=>{let f=C==s?"active":"";return n("div",{className:`item ${f}`,onClick:()=>l(s),children:[e[s],t("span",{children:a(`APPS.PHONE.${s.toUpperCase()}.TITLE`)})]},u)})})]})}export{z as PhoneContext,ze as default};
